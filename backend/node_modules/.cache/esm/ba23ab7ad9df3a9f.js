let Router,filesCtrl,getPostById,multer,path;_d9d‍.x([["default",()=>_d9d‍.o]]);_d9d‍.w("koa-router",[["default",["Router"],function(v){Router=v}]]);_d9d‍.w("./files.ctrl",[["*",null,function(v){filesCtrl=v}]]);_d9d‍.w("../posts/post.ctrl",[["getPostById",["getPostById"],function(v){getPostById=v}]]);_d9d‍.w("@koa/multer",[["default",["multer"],function(v){multer=v}]]);_d9d‍.w("path",[["default",["path"],function(v){path=v}]]);





const files = new Router();

const storage = multer.diskStorage({
    destination:(ctx,file,callback) => {
        callback(null,'../frontend/public/files');
    },
    filename:(ctx,file,callback) => {
        const extension = path.extname(file.originalname);
        const basename = path.basename(file.originalname, extension);
        callback(null,basename+"_"+Date.now()+extension);
    }
});

const upload = multer({ 
    storage: storage,
    limits: {
        files: 20,
        fileSize: 1024 * 1024 * 1024
    }
});

files.post('/:id',getPostById,upload.array('attachment',20),filesCtrl.saveFile);
files.get('/', filesCtrl.filelist);
files.delete('/:id',filesCtrl.removeFile);
_d9d‍.d(files);